name: Update Package JSON

on:
  push:
    branches:
      - main  

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Remove package-lock.json
        run: |
          if [ -f package-lock.json ]; then
            rm package-lock.json
          fi

      - name: Update package.json
        run: |
          jq '.dependencies += {"helmet": "^6.0.0", "morgan": "^1.10.0", "dotenv": "^10.0.0", "pg": "^8.6.0"}' package.json > tmp.json && mv tmp.json package.json

      - name: Commit changes
        run: |
          git config --local user.email "github-actions@github.com"
          git config --local user.name "GitHub Action"
          git add package.json
          git commit -m "Update package.json automatically" || echo "No changes to commit"

      - name: Push changes
        run: git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
